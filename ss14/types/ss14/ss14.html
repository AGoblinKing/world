<link rel="import" href="three-polymer/elements/three-scene.html"/>
<style>
    html, body { height: 100%; width: 100%; overflow: hidden; } 
</style>

<polymer-element name="game-object" extends="three-object3d" attributes="uuid">
    <script>
        Polymer("game-object", {
           ready: function() {
               this.data = Game.state[this.uuid];               
               this.super();
               
               // allow binding to game events
               if(this.game) {
                    Object.keys(this.game).forEach(function(event) {
                       Game.client.on(event, this.game[event].bind(this));
                    }.bind(this));
               }
               
               //tell the three object about this
               this.three.game = this;
               
               this.observer = new ObjectObserver(this.data, function(added, removed, changed, getOldVal) {
                    Object.keys(changed).concat(Object.keys(added)).forEach(function(key) {
                        if(this[key+"Changed"]) {
                            this[key+"Changed"](changed[key], getOldVal(changed[key]));
                        }
                    }.bind(this));
               }.bind(this));
           }
        });
    </script>
</polymer-element>


<polymer-element name="game-ss14" extends="three-scene" attributes="uuid" lightdom>
    <template>
        <style>
            @host {width: 100%; height: 100%; display: block; background-color: black;}
        </style>
    </template>
    <script>
        Polymer("game-ss14", {
            ready: function() {
                Game.target = this; 
                Game.scene = this.three;
                
                this.data = Game.state[this.uuid];
            
                Game.camera = this.camera = new THREE.PerspectiveCamera(45, this.clientWidth/this.clientHeight, 1, 1000);
                this.camera.position.set(0,10,5);
                this.camera.lookAt(new THREE.Vector3(0,0,0));
                
                this.three.add(new THREE.AmbientLight(0xF0F0F0));
                
                this.super(arguments);
                Game.canvas = this.renderer.domElement;
                this.three.add(this.camera);
                
                Game.client.emit("ready");
            }
        });
    </script>
</polymer-element>4